<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Prompt', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom right, #eff6ff, #dbeafe);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      max-width: 850px;
      width: 100%;
      background-color: #ffffff;
      padding: 2.5rem 3rem;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      margin: 2rem;
    }
    .logo {
      display: block;
      margin: 0 auto 1rem auto;
      width: 100px;
      height: auto;
    }

    h1 {
      text-align: center;
      color: #1d4ed8;
    }

    h2 {
      color: #1e3a8a;
      text-align: left;
      font-weight: 600;
    }

    .centered-header h3 {
      font-size: 1.4rem;
      font-weight: 600;
      color: #1d4ed8;
      margin: 0.3rem 0 0.6rem;
    }

    .centered-header p {
      font-size: 1rem;
      color: #444;
      margin-bottom: 1.5rem;
    }


    label {
      font-weight: 500;
      margin-top: 1rem;
      display: block;
      color: #333;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"] {
      width: 100%;
      padding: 0.6rem;
      margin-top: 0.25rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
    }

    .question {
      margin-bottom: 2rem;
    }

    .question p {
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .choice-label {
      display: block;
      margin-left: 1rem;
      margin-bottom: 0.4rem;
      font-weight: normal;
      color: #444;
    }

    button {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      margin-top: 2rem;
    }

    button:hover {
      background-color: #1d4ed8;
    }

    #result {
      text-align: center;
      font-size: 1.2rem;
      margin-top: 2rem;
    }

    .centered-header .link-section {
      margin-top: 0.5rem;
    }


    .centered-header .link-section a {
      color: #444;
      font-weight: bold;
      font-size: 1rem;
      text-decoration: none;
    }


    .centered-header .link-section a:hover {
      text-decoration: underline;
    }

    .swal2-border {
      border-radius: 12px !important;
      font-family: 'Prompt', sans-serif;
    }

    .swal2-title-custom {
      font-size: 1.2rem;
      font-weight: bold;
      color: #1e3a8a;
      /* Tailwind blue-800 */
    }

    .swal2-border {
      border-radius: 1rem;
      /* ‡∏°‡∏∏‡∏°‡πÇ‡∏Ñ‡πâ‡∏á‡∏°‡∏ô‡∏™‡∏ß‡∏¢ */
      padding: 1.2rem;
    }


    .question-container {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .question-header {
      margin-bottom: 1rem;
    }

    .question-number {
      color: #1d4ed8;
      /* Tailwind Blue-700 */
      font-size: 1.25rem;
      font-weight: 700;
      margin: 0 0 0.25rem 0;
    }

    .question-text {
      font-size: 1.1rem;
      margin: 0;
    }

    .choices {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .choice-label {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      border: 1px solid #d1d5db;
      border-radius: 0.75rem;
      transition: background 0.3s, border 0.3s;
      cursor: pointer;
    }

    .choice-label:hover {
      background: #f3f4f6;
      border-color: #2563eb;
    }

    .choice-label input[type="radio"] {
      margin-right: 0.75rem;
      accent-color: #2563eb;
    }

    .choice-text {
      font-size: 1rem;
    }


    .required-label::after {
      content: "*";
      margin-left: .25rem;
      color: #dc3545;
      /* ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏°‡πÅ‡∏ô‡∏ß Bootstrap */
    }

    header img {
      width: 100px;
      height: auto;
      margin-bottom: 1rem;
      opacity: 0;
      animation: logoFade 0.8s forwards ease;
    }

    @keyframes logoFade {
      to {
        opacity: 1;
      }
    }

    .centered-header {
      text-align: center;
    }

    .centered-header img {
      display: block;
      margin: 0 auto 1rem;
      width: 100px;
      height: auto;
      opacity: 0;
      animation: logoFade 0.8s forwards ease;
    }

    .btn {
      display: block;
      width: 100%;
      padding: 0.85rem 1.2rem;
      margin: 0.6rem 0;
      border: none;
      border-radius: 0.75rem;
      font-size: 1rem;
      font-weight: 500;
      text-align: center;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
      font-family: 'Prompt', sans-serif;
    }

    /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏´‡∏£‡∏π */
    .btn-primary {
      background-color: #2563eb;
    }

    .btn-primary:hover {
      background-color: #1e40af;
    }

    /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏™‡∏∏‡∏†‡∏≤‡∏û */
    .btn-success {
      background-color: #059669;
    }

    .btn-success:hover {
      background-color: #047857;
    }

    .btn-info {
      display: block;
      margin: 0 auto;
      padding: 0.85rem 1.5rem;
      border: none;
      border-radius: 0.75rem;
      font-size: 1rem;
      font-weight: 500;
      color: #fff;
      background-color: #475569;
      cursor: pointer;
      transition: background 0.3s;
    }
    .btn-info:hover {
      background-color: #334155;
    }
    .btn:hover {
      background-color: #1e40af;
    }
    .test-complete-message {
      font-size: 1.2rem;
      font-weight: 500;
      color: #dc2626;
      text-align: center;
      margin-top: 2rem;
      margin-bottom: 1.2rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="centered-header">
      <img src="https://github.com/ittcl999/svr-frontend/blob/main/bg-logo-transport.png?raw=true" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó" loading="lazy" decoding="async" width="100" height="100">
      <h3>‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à</h3>
      <div class="link-section">
        üìò <a href="https://drive.google.com/file/d/1Z5cbRfR9T9CL9t024MkmxzyLrROAvn9y/view" target="_blank">
          ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
        </a>
      </div>
    </header>

    <div id="infoForm">
      <label for="idCard" class="required-label">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
      <input type="tel" id="idCard" placeholder="0-0000-00000-00-0" maxlength="17">
      <label for="name" class="required-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
      <input type="text" id="name" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
      <label for="company" class="required-label">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</label>
      <input type="text" id="company" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
      <label for="phone" class="required-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
      <input type="tel" id="phone" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">
      <label for="email">Email:</label>
      <input type="email" id="email" placeholder="example@email.com">
      <div style="text-align: center;">
        <button onclick="startQuiz(event)">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
      </div>
    </div>

    <form id="quizForm" style="display:none">
      <div id="questions"></div>
      <div style="text-align: center;">
        <button type="submit">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
      </div>
    </form>

    <div id="result"></div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbym5zxW382G2enqHVpsEkltXSCeaWEXdWmUqpz11Wxfi2pxp8Pg2SP9RmCbfDLtPU6T/exec";
    let questions = [];

    async function startQuiz(event) {
      const idCardRaw = document.getElementById("idCard").value.trim();
      const idCard = idCardRaw.replace(/\D/g, "");
      const name = document.getElementById("name").value.trim();
      const company = document.getElementById("company").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const email = document.getElementById("email").value.trim();
      const startButton = event.target;
      startButton.disabled = true;
      startButton.style.display = "none";

      if (!idCard || idCard.length !== 13 || !name || !company || !phone) {
        Swal.fire({ icon: 'warning', title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á' });
        startButton.disabled = false;
        startButton.style.display = "inline-block";
        return;
      }

       Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading(),
        width: 'clamp(300px, 90%, 420px)',
        customClass: { popup: 'swal2-border', title: 'swal2-title-custom' }
      });

      try {
        const res = await fetch(`${SCRIPT_URL}?action=checkTestStatus&idCard=${idCard}`);
        const status = await res.json();

        Swal.close();

        if (status.tested) {
           Swal.fire({
              icon: 'info',
              title: '‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß', 
              html: `<span style="font-size: 1em; color: #ff0000;">‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß</span><br>
                     ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß<br>
                     ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡πÉ‡∏ô<br>
                     <span style="font-size: 1em; color: #0062ff;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${status.statusMessage}</span>
                      `, 
              confirmButtonText: '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö' ,
              width: 'clamp(300px, 90%, 420px)', // Responsive width
              confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
              confirmButtonColor: '#2563eb', // ‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö Tailwind blue-600
              customClass: {
              title: 'swal2-title-custom',
              popup: 'swal2-border'
            }
          });
        startButton.disabled = false;
        startButton.style.display = "inline-block";
        } else {
           Swal.fire({
              title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
              html: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...',
              allowOutsideClick: false,
              allowEscapeKey: false,
              didOpen: () => {
                Swal.showLoading();
              },
            width: 'clamp(300px, 90%, 420px)', // Responsive width
            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
            confirmButtonColor: '#2563eb', // ‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö Tailwind blue-600
            customClass: {
              title: 'swal2-title-custom',
              popup: 'swal2-border'
            }
          });
          const qres = await fetch(`${SCRIPT_URL}?action=getQuestions`);
          questions = await qres.json();
          Swal.close();
          document.getElementById("quizForm").style.display = "block";
          document.getElementById("infoForm").style.display = "none";
          renderQuestions();
        }
      } catch (error) {
        Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: error.message });
        startButton.disabled = false;
        startButton.style.display = "inline-block";
      }
    }

    function renderQuestions() {
      const container = document.getElementById("questions");
      container.innerHTML = "";
      questions.forEach((q, i) => {
        const div = document.createElement("div");
        div.className = "question-container";
        div.innerHTML = `
          <div class="question-header">
            <h2 class="question-number">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${i + 1}</h2>
            <p class="question-text">${q.question}</p>
          </div>
          <div class="choices">
            ${q.choices.map((c, j) => `
              <label class="choice-label">
                <input type="radio" name="q${i}" value="${j}" >
                <span class="choice-text">${c}</span>
              </label>
            `).join("")}
          </div>
        `;
        container.appendChild(div);
      });
    }

    document.getElementById("quizForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const submitBtn = e.target.querySelector("button[type='submit']");
      submitBtn.disabled = true;
      submitBtn.style.display = "none";

      const answers = questions.map((q, i) => {
        const selected = document.querySelector(`input[name='q${i}']:checked`);
        return selected ? parseInt(selected.value) : -1;
      });

      if (answers.includes(-1)) {
         Swal.fire({
          icon: 'warning',
          title: '‡∏¢‡∏±‡∏á‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠',
          text: `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${unanswered + 1})`,
          width: 'clamp(300px, 90%, 420px)',
          confirmButtonColor: '#2563eb',
          customClass: {
            title: 'swal2-title-custom',
            popup: 'swal2-border'
          }
        });
        submitBtn.disabled = false;
        submitBtn.style.display = "inline-block";
        return;
      }

      const data = {
        name: document.getElementById("name").value,
        idCard: document.getElementById("idCard").value,
        company: document.getElementById("company").value,
        phone: document.getElementById("phone").value,
        email: document.getElementById("email").value,
        answers
      };

      Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...', didOpen: () => Swal.showLoading() });

      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          body: JSON.stringify(data),
          headers: { "Content-Type": "application/json" }
        });
        const result = await res.json();
        Swal.close();
        document.getElementById("quizForm").style.display = "none";
        document.getElementById("result").innerHTML = `
          <h4 class="test-complete-message">‡∏Ñ‡∏∏‡∏ì ${data.name} ‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</h4>
          <button onclick="window.location.href='viewForm.html'" class="btn btn-info">üìÑ ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</button>
        `;
      } catch (err) {
        Swal.fire({ icon: 'error', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', text: err.message });
        submitBtn.disabled = false;
        submitBtn.style.display = "inline-block";
      }
    });

    document.getElementById("idCard").addEventListener("input", function () {
      const v = this.value.replace(/\D/g, "").slice(0, 13);
      const parts = [v.slice(0, 1), v.slice(1, 5), v.slice(5, 10), v.slice(10, 12), v.slice(12, 13)];
      this.value = parts.filter(Boolean).join("-");
    });
  </script>
</body>

</html>
